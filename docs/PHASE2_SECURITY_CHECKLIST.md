# PHASE2_SECURITY_CHECKLIST.md  
_EaglePass v2 — Security Checklist for Phase 2 PRs_  
Generated by Security GPT  
Date: 2025-06-07  

---

## Scope

This checklist defines required **security controls** that must be implemented in **Phase 2 API PRs**:

- GAS API binding layer  
- GAS UI routes  
- GAS API endpoints  

---

## 1️⃣ Emergency Mode Controls (P1)

- [ ] **API route for Emergency State toggle must enforce:**
    - [ ] Only **Admins** can toggle  
    - [ ] **2-admin confirmation flow** implemented  
    - [ ] Server-side check — cannot be bypassed by UI manipulation  

- [ ] **API route for pass creation must block if EmergencyMode.isActive() === true**  

---

## 2️⃣ Role / Permission Enforcement (P1)

- [ ] All API endpoints must enforce **permissions.js** checks  
- [ ] Admin-only routes cannot be accessed by Teachers or Students  
- [ ] Forced browsing prevention:  
    - [ ] UI routes (e.g. `/admin.html`, `/emergency.html`) must check server-side permissions  

- [ ] Negative test cases:
    - [ ] Student attempts Admin route → blocked  
    - [ ] Teacher attempts Emergency Mode toggle → blocked  
    - [ ] Student submits pass during Emergency → blocked  

---

## 3️⃣ Audit Logging (P2)

- [ ] All sensitive actions must log:  
    - [ ] Emergency Mode changes  
    - [ ] Pass created/updated/closed  
    - [ ] Settings changes  

- [ ] Logs must include:
    - [ ] `actorId`  
    - [ ] `actorRole`  
    - [ ] Timestamp  
    - [ ] Action performed  

- [ ] Logs must be persisted (not just console.log):
    - [ ] Tamper-resistant (e.g. signed rows / versioned Drive export)  

---

## 4️⃣ Input Validation / Injection Hardening (P2)

- [ ] API inputs must be validated:
    - [ ] Required fields present  
    - [ ] Data types correct  
    - [ ] No unsanitized HTML in fields (pass reasons, student names)  

- [ ] Output must be escaped where user-supplied data is rendered  

---

## 5️⃣ OAuth & Scopes Review (P3)

- [ ] Verify `appsscript.json` uses least privilege scopes  
- [ ] No unnecessary scopes included  

---

# Summary

✅ If all checklist items are complete, Phase 2 PR will be **security-approved**.  
✅ Security GPT will explicitly review Phase 2 PR against this checklist.  

---

# End of PHASE2_SECURITY_CHECKLIST.md
