# SECURITY_REVIEW_NOTES.md  
_EaglePass v2 ‚Äî Initial Security Review Notes_  
Generated by Security GPT  
Date: 2025-06-07  

---

## 1Ô∏è‚É£ Overview

These are the initial security review notes based on:
- `SPEC_v2.md`
- Current main repo structure (as reviewed from https://github.com/parkerarob/eaglepass-v2)
- Draft `Threat_Model_v2.md`

Purpose:  
- Baseline current security posture  
- Guide upcoming PR reviews  
- Identify priority risks for mitigation  

---

## 2Ô∏è‚É£ High Priority Risks (P1)

### üö® Emergency State Bypass
- **Issue:** Emergency State enforcement is currently partial:
    - Some APIs rely on UI state ‚Üí bypass risk via direct API calls
    - No 2-admin confirmation for Emergency State changes
- **Mitigation:** Server-side mandatory Emergency State checks on all sensitive APIs  
    - Require 2-admin confirmation flow for state changes  

### üö® Role Escalation
- **Issue:** Permissions checks are not fully consistent:
    - Some API routes do not explicitly validate role
    - UI-only protections present in `/admin.html`  
- **Mitigation:** Enforce centralized permission checks via `permissions.js` on all API endpoints  
    - Implement negative security tests  

---

## 3Ô∏è‚É£ Medium Priority Risks (P2)

### ‚ö†Ô∏è XSS Injection
- **Issue:** Inputs (pass reason, student names) not yet fully sanitized  
    - Risk of stored or reflected XSS in UI  
- **Mitigation:**  
    - Sanitize and escape all dynamic content in UI templates  
    - Add XSS regression tests to `security_tests.js`  

### ‚ö†Ô∏è UI Forced Browsing
- **Issue:** Certain admin/emergency UI routes are protected only via UI visibility  
    - Students or unauthorized users can force load `/admin.html` or `/emergency.html`  
- **Mitigation:**  
    - Add server-side route checks  
    - Return 403 or redirect on unauthorized access  

### ‚ö†Ô∏è Audit Log Integrity
- **Issue:** Audit logs stored in Google Sheets can be modified by privileged users  
    - No integrity verification currently  
- **Mitigation:**  
    - Implement signed hashes per log row  
    - Periodic export to versioned immutable storage (Drive or external system)  

### ‚ö†Ô∏è Google Sheets Overexposure
- **Issue:** Potential for overly broad sharing of primary data Sheet  
    - Manual Google Drive permissions can be misconfigured  
- **Mitigation:**  
    - Restrict sharing to required roles only  
    - Document sharing policy in `/SECURITY.md`  

---

## 4Ô∏è‚É£ Low Priority Risks (P3)

### ‚ö†Ô∏è OAuth Scope Review
- **Issue:** AppScript project may use broad OAuth scopes (to be verified)  
- **Mitigation:**  
    - Audit `appsscript.json`  
    - Limit to least privilege scopes  

---

## 5Ô∏è‚É£ Action Items ‚Äî Summary

| Action                               | Priority |
|--------------------------------------|----------|
| Harden Emergency State API checks     | P1       |
| Add 2-admin confirmation for state    | P1       |
| Enforce centralized permissions checks| P1       |
| Implement XSS-safe rendering          | P2       |
| Add server-side route protection      | P2       |
| Add audit log integrity protection    | P2       |
| Verify Google Sheets sharing          | P2       |
| Review OAuth scopes                   | P3       |

---

## 6Ô∏è‚É£ Next Steps

- Monitor PRs for:
    - Emergency State improvements
    - Role/permission enforcement
    - Logging changes
    - OAuth scope reduction
- Review incoming PRs using Security Review Notes Template  
- Collaborate with QA GPT to add:
    - Role escalation tests  
    - Emergency bypass tests  
    - XSS tests  
    - Forced browsing tests  

---

# End of SECURITY_REVIEW_NOTES.md
